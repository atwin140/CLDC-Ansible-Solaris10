- name: V-4300 Check
  shell: grep NFS_SERVER_VERSMAX /etc/default/nfs | grep -v ^# | egrep '2|3'
  register: checkmyconf
  ignore_errors: True
  changed_when: False

- name: V-4300 Pass
  blockinfile:
    dest: "{{out_file}}"
    state: present
    marker: "----------------------------------------------------------------------------------------------"
    block: |
      V-4300
      The NFS server must have logging implemented.
      If NFS_SERVER_VERSMAX is commented out or set to any value but 2 or 3, this is a finding.
      Procedure:
      # grep NFS_SERVER_VERSMAX /etc/default/nfs
      OUTPUT:
      {{ checkmyconf.stdout }}
      This is NOT a finding
      -
  when: checkmyconf.stdout == ""

- name: V-4300 Fix 2
  lineinfile: dest=/etc/default/nfs regexp=NFS_SERVER_VERSMAX line=NFS_SERVER_VERSMAX=3
  when: checkmyconf.stdout == ""

