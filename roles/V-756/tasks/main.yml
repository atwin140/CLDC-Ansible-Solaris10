- name: V-756 Check
  shell: grep '~:S:' /etc/inittab
  register: checkmyconf1
  ignore_errors: True
  changed_when: False

- name: V-756 Check 2
  shell: grep '~:S:' /etc/inittab
  register: checkmyconf2
  ignore_errors: True
  changed_when: False

- name: V-756 Finding Open Tags
  blockinfile:
    dest: "{{out_file}}"
    state: present
    marker: " "
    block: |
      <finding v_id="V-756" rule_id=" SV-36753r1_rule " raw_risk="I" datetime="{{ ansible_date_time.date }}">
        <title> 
        The system must require authentication upon booting into single-user and maintenance modes.
        </title>
        
        <discussion>
        If the system does not require valid root authentication before it boots into single-user or maintenance mode, anyone who invokes single-user or maintenance mode is granted privileged access to all files on the system.
        </description>
        
        <check_content>
        This can be checked in the /etc/default/sulogin file (on Solaris 5.X systems) to check if the system runs sulogin, or an equivalent, when booting into single-user mode.
        <check_content>

        <fix_text>
        Edit /etc/default/sulogin and set PASSREQ=YES or remove /etc/default/sulogin entirely. NOTE: This is a default on Solaris 5.5.1 and later. 
        </fix_text>
        <procedure>
          Procedure:
          # grep '~:S:' /etc/inittab
          NOTE: This is a default on Solaris 5.5.1 and later.
          Kernel version = {{ansible_kernel}}
        </procedure>

        <output>
          -> {{ checkmyconf1.stdout }}
        </output>


- name: V-756 Pass
  blockinfile:
    dest: "{{out_file}}"
    state: present
    marker: " "
    block: |
      <comments>
      System is set to require root authentication booting into single-user mode
      </comments>
      <status>
      Not a Finding
      </status>
      </finding>
  #: when: checkmyconf2.stdout != ""


